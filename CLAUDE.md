# CLAUDE.md

## プロジェクト概要

OIDC（OpenID Connect）の認可コードフローを学習するためのサンドボックス環境です。
AWS CDKを用いて、IDプロバイダー（Cognito）とリライイングパーティ（Lambda）を構築し、実際の挙動をハンズオン形式で確認することを目的としています。

## AIへの基本指示

- **回答言語:** 基本的にすべて**日本語**で行ってください。
- **設計参照:** `docs/` 配下に設計書が格納されています。実装や修正の提案を行う前に必ずこれらのドキュメントを参照し、設計意図に沿った回答をしてください。
- **コード品質:** 冗長なコードを避け、シンプルかつメンテナンス性の高いコードを生成してください。
- **セキュリティ:** OIDC実装におけるセキュリティ（トークンの検証、スコープの制限、ステート管理など）を最優先に考慮してください。

## 開発ガイドライン

### 1. コミットメッセージ形式

以下のフォーマットに従ってコミットメッセージを作成してください。

`type: description`

- `feat`: 新機能の追加
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの動作に影響しない変更（ホワイトスペース、フォーマット等）
- `refactor`: バグ修正や機能追加を含まないコードの整理
- `test`: テストの追加・修正
- `chore`: ビルドプロセスやライブラリの更新など

### 2. コーディングスタイル（TypeScript）

- **Lint/Formatter:** ESLint および Prettier の設定に準拠すること。
- **型定義:** `any` を極力避け、TypeScriptの型システムを最大限活用してください。
- **コメント:** \* OIDCの各ステップ（認可リクエスト、トークン交換、IDトークン検証など）には、学習者が理解できるよう詳細な日本語コメントを付与してください。
- JSDoc形式で関数の役割と引数・戻り値を明記してください。

### 3. Import 順序

以下のカテゴリ順に記載し、各グループ間は空行で区切ってください。

1. 標準ライブラリ / Node.js 組み込みモジュール (例: `fs`, `path`)
2. サードパーティライブラリ (例: `aws-cdk-lib`, `jose`)
3. プロジェクト内の自作モジュール (例: `../utils/...`)

## 技術スタック

- **言語:** TypeScript (Node.js)
- **インフラ:** AWS CDK
- **認証:** Amazon Cognito (OIDC Provider)
- **バックエンド:** API Gateway + Lambda (Relying Party)
- **フロントエンド:** S3 + CloudFront

## 主要コマンド

```bash
# インフラ操作
cd cdk && npx cdk deploy   # デプロイ
cd cdk && npx cdk destroy  # 削除
cd cdk && npx cdk diff     # 差分確認

# フロントエンド
cd frontend && npm run build # ビルド

```

## ディレクトリ構成

```text
.
├── cdk/        # AWS CDK インフラ定義
├── backend/    # Lambda 関数（OIDC RP ロジック）
├── frontend/   # 静的ファイル（TypeScript/HTML）
├── docs/       # 各種設計書・シーケンス図（最優先参照）
└── CLAUDE.md   # 本ファイル

```
