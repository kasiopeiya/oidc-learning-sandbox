# ADR-005: コールドスタート対策なし

## ステータス

採用

## 日付

2026-01-15

## コンテキスト

Lambda は一定時間使用されないとインスタンスが停止し、次回リクエスト時に再起動が必要になります。この起動時間を**コールドスタート**と呼び、初回リクエストのレスポンス時間が遅くなります。

本番環境では以下の対策が推奨されます：

1. **Provisioned Concurrency**
   - 事前にインスタンスを起動しておく
   - コスト: 高い（常時課金）

2. **定期的なウォームアップ**
   - EventBridge で定期的に Lambda を呼び出す
   - コスト: 低い

3. **依存関係の最小化**
   - node_modules を軽量化して起動を速くする
   - コスト: なし

## 決定

**コールドスタート対策は実施しません。**

## 理由

### 採用理由

1. **学習用途の特性**
   - 利用頻度が低く、数秒の遅延は許容できる
   - リアルタイム性が求められるアプリケーションではない

2. **コスト最小化**
   - Provisioned Concurrency は無料枠がなく、常時課金が発生
   - 学習用途で追加コストを避けたい

3. **シンプルさ優先**
   - ウォームアップ用の EventBridge Rule やダミー Lambda を作成すると構成が複雑化
   - OIDC の学習に集中するため、インフラは最小限にする

### 想定される影響

- 初回リクエスト（または一定時間経過後の最初のリクエスト）は 2-5秒 程度遅延する可能性
- 2回目以降のリクエストは高速（インスタンスが warm 状態）

### 既に実施している最適化

- **NodejsFunction による tree-shaking**: esbuild で不要なコードを削除し、デプロイサイズを最小化
- **arm64 アーキテクチャ**: コスト効率が良く、起動も比較的高速

## 影響

- 一定時間アクセスがない場合、次回アクセス時にコールドスタートが発生
- 本番環境に移行する場合は、Provisioned Concurrency またはウォームアップ戦略の導入を検討

## トレードオフ

| 項目                 | 学習環境（今回） | 本番環境                |
| -------------------- | ---------------- | ----------------------- |
| コールドスタート対策 | なし             | Provisioned Concurrency |
| 初回レスポンス時間   | 2-5秒            | 数百ms                  |
| 月額コスト           | $0               | $10-50                  |
| 構成の複雑さ         | シンプル         | やや複雑                |

## 参照

- [Lambda のコールドスタート解説](https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtime-environment.html)
- [Provisioned Concurrency](https://docs.aws.amazon.com/lambda/latest/dg/provisioned-concurrency.html)
