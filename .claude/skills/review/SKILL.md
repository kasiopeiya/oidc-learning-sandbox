---
name: review
description: Backend と Frontend の TypeScript アプリケーションコードをレビュー
---

# Review (Code Review) コマンド

Backend と Frontend の TypeScript アプリケーションコードを詳細にレビューし、型安全性、設計原則、セキュリティ、プロジェクトルール準拠を自動チェックするスキルです。

このスキルは、`code-reviewer-agent` サブエージェントを呼び出して、以下の処理を実行します。

## 処理内容

### Phase 1: ファイル検出とインタラクティブ選択

- Globツールで `backend/src/**/*.ts`, `frontend/src/**/*.tsx` を検出
- テストコード（`**/*.test.ts`, `**/*.test.tsx`）を除外
- CDKコード（`cdk/**/*.ts`）を除外
- ファイル一覧を種別ごとに表示（Handlers/Utilities/Pages/Contexts）
- ユーザー入力（番号またはパス）を受け付け

### Phase 2: コード種別の判定

- ファイルパスから種別を自動判定:
  - Backend Handler: `backend/src/handlers/*.ts`
  - Backend Utility: `backend/src/utils/*.ts`
  - Frontend Page: `frontend/src/pages/*.tsx`
  - Frontend Context: `frontend/src/contexts/*.tsx`
  - Frontend Utility: `frontend/src/utils/*.ts`

### Phase 3: レビュー観点の選択

**共通観点（11項目）:**

1. **型安全性**: `any` の使用、型アサーション、型推論の活用
2. **命名規則**: 変数名、関数名、定数名の適切性
3. **関数の長さ**: 適切な粒度、単一責任の原則
4. **重複コード**: DRY原則の遵守
5. **単一責任**: 関数・モジュールの責務の明確性
6. **引数の数**: 引数の数が適切か（推奨: 3つ以下）
7. **マジックナンバー**: ハードコード数値の定数化
8. **コメント**: WHYコメントの存在、自明なコードへのコメント過多
9. **エラーハンドリング**: 適切なエラー処理、エラーメッセージ
10. **セキュリティ**: ハードコード、環境変数の適切な扱い、インジェクション対策
11. **非同期処理**: Promise、async/awaitの適切な使用

**プロジェクトルール準拠:**

- **import順序**:
  - Backend: 標準ライブラリ → サードパーティ → 自作モジュール
  - Frontend: サードパーティ → 自作モジュール
  - CDK: 標準ライブラリ → サードパーティ（CDK含む） → 自作モジュール
- **日本語コメント**: 各処理ステップに日本語コメントが存在するか

### Phase 4: レビュー実行

- Readツールでファイル内容を取得
- Bashツールで git log から変更履歴を確認
- 各観点をチェック:
  - Grepで型安全性（anyの使用）を検索
  - Grepでマジックナンバー（ハードコード数値）を検索
  - Grepでセキュリティリスク（環境変数の非nullアサーションなど）を検索
  - import順序を検証
  - 関数の長さ、引数の数、コメントの質を分析
- 3点満点でスコアリング（各観点）

### Phase 5: 結果出力

**レビューレポートフォーマット:**

```
## Code Review Report

### 📁 ファイル情報
- ファイル: [ファイルパス]
- 種別: [Handler/Utility/Page/Context]
- 最終更新: [git log による最終コミット日時]

### 📊 総合評価
- スコア: X / 33点（11項目 × 3点）
- レベル: [優秀 (30+) / 良好 (24-29) / 要改善 (18-23) / 要リファクタリング (18未満)]

### ✅ 良い点（最低3つ）
- [具体的な良い点]
- [具体的な良い点]
- [具体的な良い点]

### 🔧 改善が必要な点

#### 🚨 必須（Critical）
- [セキュリティリスク、型安全性の重大な問題など]

#### ⚠️ 推奨（Recommended）
- [設計原則違反、保守性の問題など]

#### 💡 提案（Suggested）
- [命名、コメント、スタイル改善など]

### 📏 プロジェクトルールへの準拠

- ✅ / ⚠️ / ❌ import順序: [詳細]
- ✅ / ⚠️ / ❌ 日本語コメント: [詳細]

### 🚀 次のステップ（優先度付き）

1. [最優先で修正すべき項目]
2. [次に修正すべき項目]
3. [時間があれば改善したい項目]
```

## 使用方法

```
/review
```

このコマンドを実行すると、`code-reviewer-agent` サブエージェントが起動し、以下の処理を自動実行します:

1. レビュー対象ファイルの一覧表示（種別ごと）
2. ユーザーによるファイル選択（番号またはパス入力）
3. コード種別の自動判定
4. レビュー観点に基づく評価
5. 詳細レポート生成

## レビューの姿勢

エージェントは以下の姿勢でレビューを実施します:

- **建設的**: 批判ではなく、改善提案を提示
- **具体的**: 抽象的な指摘ではなく、具体的なコード例を提示
- **バランス**: 良い点も必ず指摘（最低3つ）
- **実用的**: 理想論ではなく、現実的な改善案を提示
- **根拠**: なぜその改善が必要かを明確に説明

## 既存スキルとの違い

| スキル           | スコープ                       | 用途                             |
| ---------------- | ------------------------------ | -------------------------------- |
| `/ci`            | 静的解析 + テスト（全体）      | コミット前/PR前の品質チェック    |
| `/tdd`           | テスト駆動開発（特定ファイル） | Issue ベースの機能実装           |
| `/review` (新規) | コードレビュー（特定ファイル） | 人間レビュー前の自動品質チェック |

## レビュー対象の制限

以下のファイルは**レビュー対象外**です:

- テストコード: `**/*.test.ts`, `**/*.test.tsx`
- CDKコード: `cdk/**/*.ts`（インフラコードは別途レビュー）
- 設定ファイル: `*.config.ts`, `*.config.js`

---

## 実行指示（Claude Code への指示）

このスキルが呼び出されたら、以下を**厳格に**実行すること:

### 1. エージェントの起動

Task ツールを使用して `code-reviewer-agent` サブエージェントを起動:

```
subagent_type: "code-reviewer-agent"
prompt: "Backend と Frontend の TypeScript アプリケーションコードをレビューしてください"
```

### 2. 出力の表示

エージェントが完了したら、**その出力をそのまま全文表示する**こと。

**重要**: 以下の行為は**禁止**:

- エージェントの出力を要約する
- エージェントの出力を加工する
- エージェントの出力にコメントを追加する

**許可される行為**:

- エージェントの出力を全文そのまま表示する

エージェントの出力には、レビューレポート、改善提案、次のステップが含まれているため、ユーザーにそのまま提示すること。
