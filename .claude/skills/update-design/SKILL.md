---
name: update-design
description: 指定したIssueを元に設計書を更新する仕様駆動開発サポートコマンド
---

# /update-design スキル

## 概要

Issueファイル (`docs/issues/`) に記載された内容を元に、該当する設計書 (`docs/design/`) を対話的に更新します。

本プロジェクトの仕様駆動開発フローにおける **Step 4: 設計書更新** を支援するコマンドです。

## 主な機能

- **Issue内容の自動解析**: ラベル・スコープから対象設計書を推測
- **設計書構造の解析**: セクション構造を維持した更新
- **対話的な更新**: ユーザーと確認しながら安全に更新
- **Markdown整合性チェック**: コードブロック・見出しレベルの検証
- **Next Action提案**: `/doc-reviewer` との連携を推奨

## 使用方法

```
/update-design
```

コマンド実行後、以下を対話的に入力します:

1. **Issue番号またはファイル名**
   - 例: `15` または `15-unit-tests.md`

2. **更新対象の設計書**
   - 自動検出された内容を確認・修正

3. **更新セクション**
   - 既存セクションの修正 or 新規セクション追加

4. **更新内容**
   - Issue内に記載がない場合は入力

## 処理フロー

1. **Phase 1**: Issue読み込みと解析
2. **Phase 2**: 対象設計書の特定
3. **Phase 3**: 設計書構造の解析とセクション特定
4. **Phase 4**: 更新内容の対話的な決定
5. **Phase 5**: 設計書の更新実行
6. **Phase 6**: 更新結果の報告とNext Action提案

## ラベルと設計書のマッピング

| ラベル         | 対応する設計書             |
| -------------- | -------------------------- |
| `backend`      | `backend-design.md`        |
| `frontend`     | `frontend-design.md`       |
| `infra`, `cdk` | `infrastructure-design.md` |
| `test`         | `test-specification.md`    |
| `docs`         | ユーザーに確認             |

## 既存コマンドとの連携

**開発フロー Step 4の位置付け:**

```
1. アイデア作成（docs/idea）
2. Plan作成（docs/plan）
3. Issue作成（docs/issues）← /create-issue
4. 設計書更新（docs/design）← /update-design（本コマンド）
5. 設計書レビュー（人間 + /doc-reviewer）
6. 実装（/dev）
7. デプロイ・結合テスト
```

**推奨ワークフロー:**

1. `/create-issue` でIssue作成
2. `/update-design` で設計書更新
3. `/doc-reviewer` で設計書チェック
4. 人間によるレビュー
5. `/dev` で実装開始

## 実行指示

このスキルが呼び出されたら、以下を**厳格に**実行すること:

### 1. エージェントの起動

Taskツールを使用して `update-design-agent` サブエージェントを起動:

```
subagent_type: "update-design-agent"
prompt: "Issueファイルから設計書を更新してください"
```

### 2. 出力の表示

エージェントが完了したら、**その出力をそのまま全文表示する**こと。

**重要**: 以下の行為は**禁止**:

- エージェントの出力を要約する
- エージェントの出力を加工する
- エージェントの出力にコメントを追加する

エージェントの出力には、更新結果の詳細とNext Actionが含まれているため、ユーザーにそのまま提示すること。

## 注意事項

- 設計書は重要なドキュメントのため、更新前に必ず差分を表示してユーザーに確認を求めます
- Markdown構文エラーが検出された場合は、修正を促します
- ADRファイル (`docs/adr/`) は更新対象外です
- 更新履歴はgitで管理されます（明示的な更新履歴セクションは不要）
