---
name: design
description: 統合設計ワークフロー - Issueから設計書を更新し、自動レビューまで実行する。仕様駆動開発のStep 4を完全自動化。
---

# /design スキル

## 概要

Issue ファイル (`docs/issues/`) から設計書 (`docs/design/`) を更新し、更新された設計書を自動レビューする統合ワークフローを提供します。

本プロジェクトの仕様駆動開発フローにおける **Step 4: 設計書更新** を完全自動化するコマンドです。

従来は以下の2つのコマンドを手動で順番に実行する必要がありました:

1. `/update-design` - 設計書更新
2. `/doc-reviewer` - 設計書レビュー

本スキルは、これらを **単一のコマンドで自動実行** します。

## 主な機能

- **Phase 1: 設計書更新の自動実行** - `update-design-agent` を起動し、Issue から設計書を更新
- **Phase 2: 設計書レビューの自動実行** - `doc-reviewer-agent` を起動し、更新された設計書をレビュー
- **フルアウトプット表示** - 両フェーズの出力を完全に表示（要約・加工なし）

## 使用方法

```
/design
```

コマンド実行後、以下の流れで自動実行されます:

1. **Phase 1**: Issue 番号を入力 → 設計書が更新される
2. **Phase 2**: 更新された設計書が自動レビューされる
3. **結果**: 両フェーズの完全な出力が表示される

## 処理フロー

### Phase 1: 設計書更新

1. Issue 番号またはファイル名を入力
2. ラベルから対象設計書を自動検出
3. 更新セクションを選択
4. 更新内容を入力・確認
5. 設計書を更新

### Phase 2: 設計書レビュー

1. 更新された設計書を自動検出
2. ドキュメント種別を判定
3. レビュー観点に基づいて評価
4. 詳細レポートを出力

## ワークフロー統合

本コマンドは仕様駆動開発フローの Step 4 を完全に自動化します:

```
1. アイデア作成（docs/idea）
2. Plan作成（docs/plan）
3. Issue作成（docs/issues）← /create-issue
4. 設計書更新（docs/design）← /design（本コマンド）
5. 人間によるレビュー
6. 実装（/dev）
7. デプロイ・結合テスト
```

**推奨ワークフロー:**

1. `/create-issue` で Issue 作成
2. `/design` で設計書更新 + 自動レビュー（本コマンド）
3. 人間によるレビュー
4. `/dev` で実装開始

## 実行指示

このスキルが呼び出されたら、以下を**厳格に**実行すること:

### Phase 1: 設計書更新エージェントの起動

Task ツールを使用して `update-design-agent` サブエージェントを起動:

```
subagent_type: "update-design-agent"
prompt: "Issueファイルから設計書を更新してください"
```

**完了を待ちます。**

### Phase 2: 設計書レビューエージェントの起動

**Phase 1 が完了したら**、Task ツールを使用して `doc-reviewer-agent` サブエージェントを起動:

```
subagent_type: "doc-reviewer-agent"
prompt: "更新された設計書をレビューしてください"
```

### 出力の表示

各エージェントが完了したら、**その出力をそのまま全文表示する**こと。

**重要**: 以下の行為は**禁止**:

- ❌ エージェントの出力を要約する（例: 「設計書を更新しました」のみ表示）
- ❌ エージェントの出力を加工する（例: セクションをフィルタリング）
- ❌ エージェントの出力にコメントを追加する（例: 「レビュー結果によると...」）
- ❌ エージェントの出力を再フォーマットする（例: テーブルやリストの形式変更）

**許可される行為**:

- ✅ Phase 1 の出力を全文そのまま表示する
- ✅ Phase 2 の出力を全文そのまま表示する
- ✅ 全ての Next Action 推奨を保持する
- ✅ Mermaid 図、テーブル、コードブロックをそのまま表示する

## エラーハンドリング

### Phase 1 でエラーが発生した場合

- `update-design-agent` のエラーメッセージを表示
- **Phase 2 は実行しない**
- ユーザーに再試行を促す
- 個別に `/update-design` コマンドでデバッグ可能であることを案内

### Phase 2 でエラーが発生した場合

- Phase 1 の出力は既に表示済み（設計書更新は完了）
- `doc-reviewer-agent` のエラーメッセージを表示
- ユーザーに個別に `/doc-reviewer` コマンドでレビューを実行できることを案内

### ユーザーがキャンセルした場合

- Phase 1 でキャンセル → ワークフロー終了
- Phase 2 でキャンセル → Phase 1 の変更は既に適用済み

## 注意事項

- 本コマンドの出力には、Phase 1（設計書更新）と Phase 2（設計書レビュー）の両方の結果が含まれます
- 各エージェントからの Next Action 推奨は全て保持されます
- 設計書は `docs/design/` 配下に保存されます
- Issue ファイルは `docs/issues/` 配下から読み込まれます
- Phase 2 は Phase 1 の完了後にのみ実行されます（順序保証）

## 既存コマンドとの関係

- **`/update-design`**: Phase 1 のみを単独実行
- **`/doc-reviewer`**: Phase 2 のみを単独実行
- **`/design`**: Phase 1 + Phase 2 を自動実行（本コマンド）

個別にデバッグや再実行が必要な場合は、`/update-design` または `/doc-reviewer` を単独で使用してください。
